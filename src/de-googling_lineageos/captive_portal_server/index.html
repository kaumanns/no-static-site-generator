<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
        <meta name="referrer" content="no-referrer">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta name="author" content="David Kaumanns, Ph.D." />
        <title>kaumanns.io</title>
		<style type="text/css">
			body {
				color:       #444;
				font-size:   14px;
				line-height: 1.6;
				margin:      0px auto;
				max-width:   650px;
				padding:     0 10px
        font-family: Verdana, Geneva, sans-serif;
			}
			h1,h2,h3 {
				line-height: 1.2;
			}
      article,footer {
        margin: 40px 10px 40px 10px;
      }
      a {
        color:           SteelBlue;
        text-decoration: none;
      }
      a:hover {
        color: Blue;
      }
      pre {
        background:    #002b36;
        border-radius: 8px;
        color:         #fdf6e3;
        counter-reset: line;
        display:       block;
        overflow:      auto;
        padding:       5px;
        tab-size:      2;
      }
      figure figcaption {
        text-align: center
      }
      figure img {
        display:      block;
        margin-left:  auto;
        margin-right: auto;
        max-width:    400px;
        width:        75%;
      }
      .tag {
        background:    SteelBlue;
        border-radius: 4px;
        color:         white;
        padding:       2px;
      }
      .center {
        text-align: center
      }
      .bigger {
        font-size: larger;
      }
		</style>
	</head>
	<body>
        <main>
            <nav class="center">
                <p class="bigger">
                  david kaumanns.io
                </p>
                <p class="logo">
                  <a href="/">
                      <img alt="Logo" style="border-width:0" src="/logo.png" />
                  </a>
                </p>
                <!-- <p> -->
                <!--   Minimal Computing, Computational Linguistics and some Space Piracy -->
                <!-- </p> -->
            </nav>
            <article>
    <header>
                <p class="center">
            <a href="..">De-Googling Lineage OS 18.1</a>
        </p>
        <h1 class="center">
            <a href=".">Captive Portal Server</a>
        </h1>
                        <p class="center">
                        <span class="tag">Privacy</span>        </p>
                        <p class="last_update center">
            Last update: <time>09.09.2021</time>
        </p>
            </header>
    <p><strong>Requirements</strong>:</p>
    <ul>
    <li>Ability to open the command line on a *nix machine.</li>
    <li>Android Debuge Bridge (ADB) set up on a host machine</li>
    <li>Device connected to that host machine</li>
    </ul>
    <hr />
    <p>By default, each time your device connects to the internet via wifi, it asks Google’s <a href="https://en.wikipedia.org/wiki/Captive_portal">captive portal</a> server (<code>connectivitycheck.gstatic.com</code>) for a specific response code: <code>HTTP 204</code>. Only if that response code is delivered will your device connect to the internet.</p>
    <p>Let’s remove Google from this equation.</p>
    <p>From a host machine (connected via USB), give yourself root access to the device’s shell:</p>
    <pre><code>$ adb root
    $ adb shell</code></pre>
    <p>Then choose one of the following options:</p>
    <h3 id="option-1-provide-an-alternative-captive-portal-server">Option 1: Provide an alternative Captive Portal server</h3>
    <p>For example <a href="https://www.kuketz-blog.de/empfehlungsecke/#captive-portal">Kuketz’ server</a>:</p>
    <pre class="shell"><code># settings put global captive_portal_http_url &quot;http://captiveportal.kuketz.de&quot;
    # settings put global captive_portal_https_url &quot;https://captiveportal.kuketz.de&quot;
    # settings put global captive_portal_fallback_url &quot;http://captiveportal.kuketz.de&quot;
    # settings put global captive_portal_other_fallback_urls &quot;http://captiveportal.kuketz.de&quot;</code></pre>
    <p>Reboot.</p>
    <h3 id="option-2-disable-captive-portal-lookup">Option 2: Disable Captive Portal lookup</h3>
    <p>This option may cause problems with wifi login forms, but it may be worth a try:</p>
    <pre><code># pm disable com.android.captiveportallogin
    # settings put global captive_portal_detection_enabled 0
    # settings put global captive_portal_server localhost
    # settings put global captive_portal_mode 0</code></pre>
    <p>Reboot.</p>
    <h3 id="nice-to-know-how-to-test-the-new-captive-portal-setting">Nice to know: how to test the new Captive Portal setting</h3>
    <p>The <em>/e/ foundation</em> apparently change the AOSP source code itself in order to control the Captive Portal setting:</p>
    <ul>
    <li><a href="https://doc.e.foundation/what-s-e#degoogling--ungoogling" class="uri">https://doc.e.foundation/what-s-e#degoogling--ungoogling</a></li>
    <li>Whitepaper: <a href="https://e.foundation/wp-content/uploads/2020/09/e-state-of-degooglisation.pdf" class="uri">https://e.foundation/wp-content/uploads/2020/09/e-state-of-degooglisation.pdf</a></li>
    </ul>
    <p>It seems that Android allows (or allowed) a mere change of certain global variables to control the Captive Portal setting: <a href="https://www.kuketz-blog.de/empfehlungsecke/#captive-portal" class="uri">https://www.kuketz-blog.de/empfehlungsecke/#captive-portal</a> (German).</p>
    <p>However, these variables are <code>null</code> prior to setting it. (At least they were for me.) So why should we believe that Android actually respects these global variables?</p>
    <p>As noted above, an internet connection will be refused if the expected response code is not delivered.</p>
    <p>Using <em>AdAway</em> (or any other host blocker), we can verify this behaviour by adding <code>connectivitycheck.gstatic.com</code> to the blacklist before changing the global variables: No more internet connection.</p>
    <p>After changing the Captive Portal settings, I observe a successful connection, even though Google’s server is blocked.</p>
    <p>My best guess is therefore that it works, even though we do not fiddle with the source code as <em>/e/</em> does.</p>
</article>
<hr>
<hr>

            <footer>
                <small>
                    <p class="author">
                    By David Kaumanns, Ph.D.
                    </p>
                    <p>
                        Throw me a wrench via:
                        <ul>
                            <li>
                                Email: david [ätt] kaumanns.io
                                (<a href="https://keys.openpgp.org/vks/v1/by-fingerprint/83B21DD6874CED29DE990531235B047EF5F74CB5">PGP-Key</a>)
                            </li>
                            <li>
                                Matrix: @mael:hackbrettl.de
                            </li>
                            <li>
                                Github: <a href="https://github.com/kaumanns">github.com/kaumanns</a>
                            </li>
                        </ul>
                    </p>
                    <hr>
                    <p>
                    This site was created with my own <a href="https://github.com/kaumanns/no-static-site-generator">no-static-site-generator</a>
                        and is served by a Raspberry Pi 3.
                        The stylesheet is inspired by <a href="https://bettermotherfuckingwebsite.com">bettermotherfuckingwebsite.com</a>.
                    </p>
                    <p>
                        All code is licensed under <a rel="license" href="https://www.gnu.org/licenses/gpl-3.0.html">GPLv3</a>.
                    </p>
                    <p>
                        All other content is licensed under a <a rel="license" href="https://creativecommons.org/licenses/by-nc/4.0/">Creative Commons Attribution-NonCommercial 4.0 International License</a>.
                        <br />
                        <a rel="license" href="https://creativecommons.org/licenses/by-nc/4.0/">
                            <img alt="Creative Commons License" style="border-width:0" src="/creative_commons.png" />
                        </a>
                    <p>
                </small>
            </footer>
        </main>
	</body>
</html>
